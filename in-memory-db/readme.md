# In Memory Database

در این تسک از شما میخواهیم یک دیتابیس بنویسید که دیتاها را در قالب key-value در memory ذخیره میکند.

ارتباط با دیتابیس از طریق دستورات command line برقرار می شود.

این سیستم به شکل پیشفرض باید یک دیتابیس default داشته باشد که ابتدا به آن متصل می‌شود. همچنین باید قابلیت اضافه کردن دیتابیس به سیستم وجود داشته باشد.

## دستورات برنامه

</br>

### ذخیره یک مقدار

این دستور یک کلید و مقدار میگیرد و آن را در دیتابیس ذخیره می کند. ورودی سوم این دستور که optional است،
مقدار ttl(time to live) این کلید در واحد ثانیه است. به این معنا که اگر ورودی آن x باشد این کلید باید به مدت x ثانیه در دیتابیس باشد و پس از x ثانیه حذف شود. در صورتی که ttl وارد نشود یعنی کلید مربوطه برای همیشه باید در دیتابیس باقی بماند.

```
set [key] [value] [ttl option]
```

ورودی نمونه ۱:

```
set rahnema backend
```

خروجی نمونه ۱:

```
ok
```

ورودی نمونه ۲:

```
set hello salam 3
```

این ورودی یعنی این key-value باید به مدت ۳ ثانیه در دیتابیس باشد و پس از آن از بین برود.

خروجی نمونه ۱:

```
ok
```

<br></br>

### گرفتن مقدار یک کلید

این دستور یک کلید میگیرد و مقدار ذخیره شده به ازای این کلید در دیتابیس را ‍برمیگرداند. در صورتی که این کلید وجود نداشت ‍`null` برگرداند.‍<br>درصورتی که یک کلید set شده باشد ولی ttl آن به اتمام رسیده باشد get کردن آن باید پاسخ null داشته باشد.

```
get [key]
```

ورودی نمونه ۱:

```
get rahnema
```

خروجی نمونه ۱:

```
backend
```

ورودی نمونه ۲:

```
get college
```

خروجی نمونه ۲:

```
null
```

<br></br>

### حذف یک کلید

در ورودی یک کلید گرفته و آن رکورد (کلید و مقدار) را از دیتابیس حذف میکند.
در صورتی که آن کلید در دیتابیس باشد خروجی برابر ‍`True` و در غیر این صورت `False` است.

```
del [key]
```

ورودی نمونه ۱:

```
del rahnema
```

خروجی نمونه ۱:

```
true
```

ورودی نمونه ۲:

```
del college
```

خروجی نمونه ۲:

```
false
```

<br></br>

### سرچ روی کلیدها

یک regex میگیرد و لیست کلیدهایی که با آن match می شود را باز میگرداند.
این دستور دو ورودی optional دارد که یکی limit است و دیگری page.
limit تعداد مدنظر خروجی را مشخص میکند و page نیز مشخص میکند که چند کلید skip شود.
به اندازه (page-1) \* limit کلید جلو میرویم.
اگر limit وارد نشود مقدار پیش فرض آن ۱۰و اگر page وارد نشود مقدار پیش فرض آن ۱ است.

```
keys [regex] page [x] limit [y]
```

ورودی نمونه ۱:

```
keys rahnema* page 1 limit 10
```

خروجی نمونه ۱:

```
['rahnema-college', 'rahnema_bootcamp']
```

ورودی نمونه ۲:

```
keys x
```

خروجی نمونه ۲:

```
[]
```

<br></br>

### استفاده از یک دیتابیس

نام یک دیتابیس را میگیرد. در صورتی که دیتابیسی با این نام از قبل ساخته شده باشد به آن switch می کند و در غیر این صورت یک دیتابیس با آن نام ساخته و سپس به آن switch میکند.
<br>در حالتی که قرار است دیتابیس جدیدی ساخته شود می توان علاوه بر نام دیتابیس، دو ورودی optional دیگر نیز به آن داد. <br><br>ورودی اول **max-size** می باشد که نشان دهنده بیشترین تعداد کلیدی است که این دیتابیس می تواند در خودش ذخیره کند.(مقدار دیفالت این فیلد عدد ۱۰ می باشد. یعنی اگر کاربر آن را مشخص نکرد مقدار ۱۰ در آن قرار بگیرد) <br>ورودی دوم **eviction-policy** می باشد که نشان دهنده سیاست حذف کلیدها در زمانی که دیتابیس پر می شود می باشد. این سیاست ۳ حالت دارد:
<br>**۱. random:** در این حالت زمانی که دیتابیس پر شده و یک کلید جدید میخواهد اضافه شود، به صورت تصادفی یکی از کلیدهای موجود حذف شده و کلید جدید اضافه می شود.<br>**۲. noeviction:** در این حالت زمانی که دیتابیس پر شود، تا زمانی که یک کلید حذف نشود نمی توان در دیتابیس کلید جدیدی اضافه کرد و set کردن یک کلید باید با خطا مواجه شود.<br>**۳. lru(least recently used):** در این روش کلیدی حذف می شود که قدیمی ترین زمان استفاده یا get شدن را دارد.(مقدار دیفالت این فیلد random می باشد

```
use [db-name] [max-size] [eviction-policy]
```

ورودی نمونه ۱:

```
use rahnema_db 10 lru
```

خروجی نمونه ۱:

```
db switched
```

<br></br>

### گرفتن لیست دیتابیس ها

لیست دیتابیس های موجود در سیستم را بازمی گرداند.

```
list
```

ورودی نمونه ۱:

```
list
```

خروجی نمونه ۱:

```
['rahnema_db', 'default']
```

<br></br>

### خروج از برنامه

این دستور برنامه را تمام می کند و خروجی ای ندارد

```
exit
```
